<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Model Deep Research Workflow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .diagram-container {
            margin: 40px 0;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .diagram {
            max-width: 100%;
            overflow-x: auto;
        }
        .model-strategy {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .model-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background-color: white;
        }
        .download-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #e8f5e9;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>Multi-Model Deep Research Workflow</h1>
    
    <p>This documentation outlines our approach to analyzing 100-200 web searches efficiently using a multi-model strategy with cost and time optimization.</p>
    
    <h2>Architecture Overview</h2>
    <div class="diagram-container">
        <div class="diagram">
            <pre class="mermaid">
graph TD
    A[User Query] --> B[Query Decomposition<br>Claude 3.7 Sonnet]
    B --> C1[Web Search 1<br>Firecrawl]
    B --> C2[Web Search 2<br>Firecrawl]
    B --> C3[Web Search 3<br>Firecrawl]
    B --> CN[Web Search N<br>Firecrawl]
    
    subgraph "Content Processing Pipeline"
        C1 --> D1[Model A<br>DeepSeek R1]
        C2 --> D2[Model B<br>Sonar Reasoning]
        C3 --> D3[Model C<br>Claude 3.7 Sonnet]
        CN --> D4[Model D<br>Gemini Flash]
    end
    
    D1 --> E[Result Aggregation<br>Claude 3.7 Sonnet]
    D2 --> E
    D3 --> E
    D4 --> E
    
    E --> F[Progressive UI Updates<br>Stream]
    
    classDef primaryNode fill:#f9d5e5,stroke:#333,stroke-width:2px;
    classDef secondaryNode fill:#d3f0ee,stroke:#333,stroke-width:1px;
    classDef processingNode fill:#eeeeee,stroke:#999,stroke-width:1px;
    
    class A,B,E,F primaryNode;
    class C1,C2,C3,CN secondaryNode;
    class D1,D2,D3,D4 processingNode;
            </pre>
        </div>
    </div>
    
    <h2>Data Flow Sequence</h2>
    <div class="diagram-container">
        <div class="diagram">
            <pre class="mermaid">
sequenceDiagram
    participant User
    participant Frontend
    participant QueryPlanner
    participant SearchService
    participant ModelPool
    participant Aggregator
    
    User->>Frontend: Submit Research Topic
    Frontend->>QueryPlanner: Decompose Topic
    Note over QueryPlanner: Using Claude 3.7 Sonnet
    
    QueryPlanner->>Frontend: Stream: Planning Started
    QueryPlanner-->>Frontend: Stream: Generating Queries
    
    loop For each query batch (20-30 queries)
        QueryPlanner->>SearchService: Execute Searches in Parallel
        SearchService-->>Frontend: Stream: Search Progress
        
        loop For each result
            SearchService->>ModelPool: Analyze Content
            Note over ModelPool: Selects Appropriate Model<br>Based on Content Type
            ModelPool-->>Frontend: Stream: Analysis Progress
        end
        
        ModelPool->>Aggregator: Batch Results
        Aggregator-->>Frontend: Stream: Batch Summary
    end
    
    Aggregator->>Aggregator: Final Synthesis
    Note over Aggregator: Using Claude 3.7 Sonnet
    
    Aggregator->>Frontend: Stream: Complete Results
    Frontend->>User: Display Research Report
            </pre>
        </div>
    </div>
    
    <h2>Model Selection Strategy</h2>
    <div class="diagram-container">
        <div class="diagram">
            <pre class="mermaid">
graph TD
    A[Content to Analyze] --> B{Content Type?}
    B -->|Technical| C[DeepSeek R1]
    B -->|Academic/Scholarly| D[Claude 3.7 Sonnet]
    B -->|General| E[Sonar Reasoning]
    B -->|Large Document| F[Gemini Flash]
    
    C --> G{Relevance Score?}
    D --> G
    E --> G
    F --> G
    
    G -->|High > 0.8| H[Deep Analysis<br>Claude 3.7 Sonnet]
    G -->|Medium 0.5-0.8| I[Standard Analysis<br>DeepSeek R1]
    G -->|Low < 0.5| J[Quick Analysis<br>DeepSeek Distill 70B]
    
    H --> K[Result with Confidence Score]
    I --> K
    J --> K
    
    classDef decision fill:#ffcc99,stroke:#333,stroke-width:1px;
    classDef model fill:#99ccff,stroke:#333,stroke-width:1px;
    classDef input fill:#ccffcc,stroke:#333,stroke-width:1px;
    classDef output fill:#ffcccc,stroke:#333,stroke-width:1px;
    
    class A input;
    class B,G decision;
    class C,D,E,F,H,I,J model;
    class K output;
            </pre>
        </div>
    </div>
    
    <h2>Streaming Updates Flow</h2>
    <div class="diagram-container">
        <div class="diagram">
            <pre class="mermaid">
flowchart TD
    subgraph "Server-Side Processing"
        A[Research Process Starts] --> B[Generate 20-30 Search Queries]
        B --> C[Execute Batch of Searches]
        C --> D[Process Search Results]
        D --> E[Analyze Content with Models]
        E --> F[Aggregate Batch Results]
        F --> G{More Batches?}
        G -->|Yes| C
        G -->|No| H[Final Synthesis]
    end
    
    subgraph "Data Streaming"
        A -.-> S1[Stream: Research Started]
        B -.-> S2[Stream: Queries Generated]
        C -.-> S3[Stream: Searches In Progress]
        C -.-> S4[Stream: Search X/Y Complete]
        D -.-> S5[Stream: Processing Results]
        E -.-> S6[Stream: Analysis X% Complete]
        F -.-> S7[Stream: Batch X/Y Complete]
        H -.-> S8[Stream: Final Results]
    end
    
    subgraph "Client-Side UI"
        S1 -.-> U1[Show Welcome Message]
        S2 -.-> U2[Display Query List]
        S3 -.-> U3[Show Progress Bar]
        S4 -.-> U4[Update Results Count]
        S5 -.-> U5[Show Processing Animation]
        S6 -.-> U6[Update Analysis Progress]
        S7 -.-> U7[Display Interim Results]
        S8 -.-> U8[Show Complete Research Report]
    end
    
    classDef processing fill:#e1f5fe,stroke:#0288d1,stroke-width:1px;
    classDef stream fill:#fff8e1,stroke:#ffa000,stroke-width:1px;
    classDef ui fill:#e8f5e9,stroke:#388e3c,stroke-width:1px;
    
    class A,B,C,D,E,F,G,H processing;
    class S1,S2,S3,S4,S5,S6,S7,S8 stream;
    class U1,U2,U3,U4,U5,U6,U7,U8 ui;
            </pre>
        </div>
    </div>
    
    <h2>Model Selection Details</h2>
    <div class="model-strategy">
        <div class="model-card">
            <h3>Claude 3.7 Sonnet</h3>
            <p><strong>Best for:</strong> Query planning, academic content, final synthesis</p>
            <p><strong>Context:</strong> 200K tokens</p>
            <p><strong>Strengths:</strong> Reasoning, context understanding, nuanced analysis</p>
        </div>
        <div class="model-card">
            <h3>DeepSeek R1</h3>
            <p><strong>Best for:</strong> Technical content, code analysis</p>
            <p><strong>Context:</strong> 128K tokens</p>
            <p><strong>Strengths:</strong> Tech documentation, math reasoning</p>
        </div>
        <div class="model-card">
            <h3>Sonar Reasoning</h3>
            <p><strong>Best for:</strong> General content analysis</p>
            <p><strong>Context:</strong> 127K tokens</p>
            <p><strong>Strengths:</strong> Balanced performance and cost</p>
        </div>
        <div class="model-card">
            <h3>Gemini Flash</h3>
            <p><strong>Best for:</strong> Large document processing</p>
            <p><strong>Context:</strong> 1M tokens</p>
            <p><strong>Strengths:</strong> Summarization of extensive content</p>
        </div>
    </div>
    
    <div class="download-section">
        <h2>Implementation Guide</h2>
        <p>To implement this workflow in your codebase:</p>
        <ol>
            <li>Extend the <code>UnifiedResearchAgent</code> class to support multi-model selection</li>
            <li>Implement parallel processing with worker pools</li>
            <li>Enhance the streaming response format for real-time UI updates</li>
            <li>Add content type detection for intelligent model routing</li>
            <li>Implement batch processing to handle larger query sets</li>
        </ol>
    </div>
    
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            themeVariables: {
                fontSize: '16px'
            }
        });
    </script>
</body>
</html> 